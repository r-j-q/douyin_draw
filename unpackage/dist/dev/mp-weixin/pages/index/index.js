(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{33:function(e,t,n){"use strict";(function(e,t){var o=n(4);n(26);o(n(25));var i=o(n(34));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n(1)["default"],n(2)["createPage"])},34:function(e,t,n){"use strict";n.r(t);var o=n(35),i=n(37);for(var c in i)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(c);n(43);var r,s=n(32),a=Object(s["default"])(i["default"],o["render"],o["staticRenderFns"],!1,null,"57280228",null,!1,o["components"],r);a.options.__file="pages/index/index.vue",t["default"]=a.exports},35:function(e,t,n){"use strict";n.r(t);var o=n(36);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},36:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return i})),n.d(t,"staticRenderFns",(function(){return r})),n.d(t,"recyclableRender",(function(){return c})),n.d(t,"components",(function(){return o}));var i=function(){var e=this,t=e.$createElement;e._self._c},c=!1,r=[];i._withStripped=!0},37:function(e,t,n){"use strict";n.r(t);var o=n(38),i=n.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=i.a},38:function(e,t,n){"use strict";(function(e,o){var i=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=i(n(39)),r=i(n(41)),s=(i(n(57)),{data:function(){return{showButton:!1,duration:5e3,list:[],deviceId:"",serviceId:"",characteristics:[],characteristicId:"",lanya:n(42),getUserInfo:{},getUserInfoDataToken:!1,code:"",address:"",positionInfo:{address:"",longitude:"",latitude:""}}},onLoad:function(){var t=this;console.log("纬度");var o=n(57),i=new o({key:"OB7BZ-S6FWT-GOBXR-LONYL-GKEE5-OTBRD"});e.getLocation({type:"wgs84",success:function(t){console.log("纬度",t),e.setStorageSync("latitude",t.latitude),e.setStorageSync("longitude",t.longitude)},complete:function(){i.reverseGeocoder({location:{latitude:e.getStorageSync("latitude"),longitude:e.getStorageSync("longitude")},success:function(n){console.log(11,n.result.address_component.city),t.address=n.result.address_component.city,console.log(22,t.address),e.setStorageSync("address_component",n.result.address_component.city)},fail:function(e){console.error("错误了",e)}})}})},onShow:function(){this.handleOpenBluetoothAdapter();var e=o.getStorageSync("usersInfo");e&&(this.getUserInfo=JSON.parse(e),this.getUserInfo.data&&this.getUserInfo.data.userinfo&&(this.getUserInfoDataToken=!!this.getUserInfo.data.userinfo))},methods:{getCurrentLocation:function(){var e=this;o.getLocation({type:"wgs84",success:function(t){console.log("===8888====>",t),e.positionInfo.longitude=t.longitude,e.positionInfo.latitude=t.latitude,e.loAcquire(e.positionInfo.longitude,e.positionInfo.latitude)}})},loAcquire:function(e,t){var n=this;o.showLoading({title:"加载中",mask:!0});var i="output=jsonp&key='OB7BZ-S6FWT-GOBXR-LONYL-GKEE5-OTBRD'=".concat(t,",").concat(e);this.$jsonp("https://apis.map.qq.com/ws/geocoder/v1/?"+i,{}).then((function(e){console.log(e),o.hideLoading(),0==e.status&&(n.positionInfo.address="当前位置是:"+e.result.address_component.street_number,console.log("===9999====>",n.positionInfo))}))},loginfn:function(){var t=this;e.login({success:function(e){t.code=e.code}})},onGetPhoneNumber:function(e){var t=this;return(0,r.default)(c.default.mark((function n(){var o,i,r,s;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:o=t,"getPhoneNumber:ok"===e.detail.errMsg&&(i=e.detail,r=i.iv,s=i.encryptedData,o.getawardDetail(o.code,s,r));case 2:case"end":return n.stop()}}),n)})))()},getawardDetail:function(e,t,n){var i=this;o.request({url:"http://ys.shningmi.com/api/login/login",data:{code:e,encryptedData:t,iv:n},header:{"Content-Type":"application/json"},method:"POST",success:function(e){var t=e.data;o.setStorageSync("usersInfo",JSON.stringify(t)),i.getUserInfo=JSON.parse(o.getStorageSync("usersInfo")),console.log("缓存数据--1----",i.getUserInfo.data),i.getUserInfo.data&&i.getUserInfo.data.userinfo&&(console.log("缓存数据--2----",i.getUserInfo.data.userinfo),i.getUserInfoDataToken=!!i.getUserInfo.data.userinfo)}})},handleOpenBluetoothAdapter:function(){var e=this;o.openBluetoothAdapter({success:function(t){o.getBluetoothAdapterState({success:function(t){console.log(t,"本机设备的蓝牙已打开"),e.startBluetoothDeviceDiscovery()},fail:function(e){o.showToast({icon:"none",duration:this.duration,title:"查看手机蓝牙是否打开"})}})},fail:function(t){o.showToast({icon:"none",duration:e.duration,title:"查看手机蓝牙是否打开"})}})},startBluetoothDeviceDiscovery:function(){var e=this;o.startBluetoothDevicesDiscovery({success:function(t){console.log("startBluetoothDevicesDiscovery success",t),e.onBluetoothDeviceFound()},fail:function(e){console.log(e,"错误信息")}})},onBluetoothDeviceFound:function(){var e=this;o.onBluetoothDeviceFound((function(t){-1==e.list.indexOf(t.devices[0].deviceId)&&"WMD8"===t.devices[0].name.slice(0,4)&&(e.createBLEConnection(t.devices[0].deviceId),e.list.push({name:t.devices[0].name,deviceId:t.devices[0].deviceId}))}))},getBluetoothDevices:function(){console.log("获取蓝牙设备"),o.getBluetoothDevices({success:function(e){console.log("获取蓝牙设备成功:"),console.log(e.devices)}})},createBLEConnection:function(e){var t=this;this.deviceId=e,o.createBLEConnection({deviceId:this.deviceId,success:function(e){console.log("蓝牙连接成功",e),t.getBLEDeviceServices()},fail:function(e){console.log("蓝牙连接失败",e)}})},stopBluetoothDevicesDiscovery:function(){var e=this;o.stopBluetoothDevicesDiscovery({success:function(t){e.loading=!1,console.log("停止搜索蓝牙设备:"+t.errMsg)},fail:function(e){console.log("停止搜索蓝牙设备失败，错误码："+e.errCode)}})},getBLEDeviceCharacteristics:function(){var e=this,t=this;console.log("进入特征"),setTimeout((function(){o.getBLEDeviceCharacteristics({deviceId:e.deviceId,serviceId:e.serviceId,success:function(n){console.log("特征getBLEDeviceCharacteristics",n),e.characteristics=n.characteristics,console.log("特征数组",e.characteristics),n.characteristics.forEach((function(e){-1!=e.uuid.indexOf("FFE1")&&(t.characteristicId=e.uuid,t.notifyBLECharacteristicValueChange(e.uuid))}))},fail:function(e){console.log(e)}})}),1e3)},notifyBLECharacteristicValueChange:function(e){var t=this;console.log(e,"characteristicId"),o.notifyBLECharacteristicValueChange({state:!0,deviceId:this.deviceId,serviceId:this.serviceId,characteristicId:e,success:function(e){console.log(e),t.listenValueChange(),console.log("notifyBLECharacteristicValueChange success",e.errMsg)},fail:function(e){console.log("notifyBLECharacteristicValueChange fail",e.errMsg)}})},getBLEDeviceServices:function(){var e=this;setTimeout((function(){o.getBLEDeviceServices({deviceId:e.deviceId,success:function(t){console.log("获取到蓝牙所有的服务:",t),t.services.forEach((function(t){-1!=t.uuid.indexOf("FFE0")&&(e.serviceId=t.uuid,console.log("1800特征值",e.serviceId),e.getBLEDeviceCharacteristics())}))}})}),1e3)},strToHexCharCode:function(e){if(""===e)return"";var t=[];t.push("0x");for(var n=0;n<e.length;n++)t.push(e.charCodeAt(n).toString(16));return t.join("")},handleInToPay:function(){var e={deviceId:this.deviceId,serviceId:this.serviceId,unids:this.list[0].name.slice(4),characteristicId:this.characteristicId},t=JSON.stringify(e);o.navigateTo({url:"/pages/game/detail?param="+t})},writeBLECharacteristicValue:function(e){var t=this;return(0,r.default)(c.default.mark((function n(){var i,r,s,a,u,d,l;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:for(console.log("这页面传入PCSS是唤醒功能",e),console.log("这页面传入PCSS是唤醒功能1",t.deviceId),console.log("这页面传入PCSS是唤醒功能2",t.serviceId),console.log("这页面传入PCSS是唤醒功能3",t.characteristicId),i=t.list[0].name.slice(4),r=e+i,s=new ArrayBuffer(r.length),a=new DataView(s),u=0;u<r.length;u++)a.setUint8(u,r.charAt(u).charCodeAt());d=t.ab2hex(s)+"0D0A",l=new Uint8Array(d.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer,console.log("这页面传入PCSS是唤醒功能3buffers",l),o.writeBLECharacteristicValue({deviceId:t.deviceId,serviceId:t.serviceId,characteristicId:t.characteristicId,value:l,success:function(e){console.log("写入成功",e),o.showToast({icon:"none",title:"开启成功"})},fail:function(e){console.log("写入失败1",JSON.stringify(e))}});case 13:case"end":return n.stop()}}),n)})))()},string2buffer:function(e){for(var t="",n=0;n<e.length;n++)""===t?t=e.charCodeAt(n).toString(16):t+=","+e.charCodeAt(n).toString(16);return console.log("16数据",t),new Uint8Array(t.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer},str2ab:function(e){for(var t=new ArrayBuffer(e.length/2),n=new Uint8Array(t),o=0;o<n.length;o++)n[o]=parseInt(e.substr(2*o,2),16);return t},ab2hex:function(e){var t=Array.prototype.map.call(new Uint8Array(e),(function(e){return e.toString(16).slice(-2)}));return t.join("")},hexCharCodeToStr:function(e){var t,n=e.trim(),o="0x"===n.substr(0,2).toLowerCase()?n.substr(2):n,i=o.length;if(i%2!==0)return alert("存在非法字符!"),"";for(var c=[],r=0;r<i;r+=2)t=parseInt(o.substr(r,2),16),c.push(String.fromCharCode(t));return c.join("")},listenValueChange:function(){var e=this;console.log("进去了吗"),e.showButton=!0,o.onBLECharacteristicValueChange((function(t){console.log("进去了吗1111",t);var n=e.ab2hex(t.value);console.log(n);var o=e.hexCharCodeToStr(n);console.log("最终结果",o)}))},createorder:function(e,t){var n=this;return(0,r.default)(c.default.mark((function i(){var r;return c.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return r=n,i.next=3,o.request({url:"http://ys.shningmi.com/api/order/create",data:{guid:"guid",qty:t},header:{"Content-Type":"application/json",token:n.getUserInfo.data.token},method:"POST",success:function(t){o.requestPayment({provider:"wxpay",timeStamp:t.data.data.timeStamp,nonceStr:t.data.data.nonceStr,package:t.data.data.package,signType:t.data.data.signType,paySign:t.data.data.sign,success:function(t){console.log("支付成功",t),r.writeBLECharacteristicValue(e)},fail:function(e){console.log("支付失败",e)}})}});case 3:case"end":return i.stop()}}),i)})))()}}});t.default=s}).call(this,n(1)["default"],n(2)["default"])},43:function(e,t,n){"use strict";n.r(t);var o=n(44),i=n.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=i.a},44:function(e,t,n){}},[[33,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/index.js.map