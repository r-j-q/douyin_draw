(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"650e":function(e,t,i){"use strict";i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){}));var c=function(){var e=this.$createElement;this._self._c},n=[]},"7fe9":function(e,t,i){},b9e4:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c={data:function(){return{showButton:!1,duration:5e3,list:[],deviceId:"",serviceId:"",characteristics:[],characteristicId:"",lanya:i("a833")}},onShow:function(){this.handleOpenBluetoothAdapter()},methods:{handleOpenBluetoothAdapter:function(){var t=this;e.openBluetoothAdapter({success:function(i){e.getBluetoothAdapterState({success:function(e){console.log(e,"本机设备的蓝牙已打开"),t.startBluetoothDeviceDiscovery()},fail:function(t){e.showToast({icon:"none",duration:this.duration,title:"查看手机蓝牙是否打开"})}})},fail:function(i){e.showToast({icon:"none",duration:t.duration,title:"查看手机蓝牙是否打开"})}})},startBluetoothDeviceDiscovery:function(){var t=this;e.startBluetoothDevicesDiscovery({success:function(e){console.log("startBluetoothDevicesDiscovery success",e),t.onBluetoothDeviceFound()},fail:function(e){console.log(e,"错误信息")}})},onBluetoothDeviceFound:function(){var t=this;e.onBluetoothDeviceFound((function(e){-1==t.list.indexOf(e.devices[0].deviceId)&&"WMD8"===e.devices[0].name.slice(0,4)&&(t.createBLEConnection(e.devices[0].deviceId),t.list.push({name:e.devices[0].name,deviceId:e.devices[0].deviceId}))}))},getBluetoothDevices:function(){console.log("获取蓝牙设备"),e.getBluetoothDevices({success:function(e){console.log("获取蓝牙设备成功:"),console.log(e.devices)}})},createBLEConnection:function(t){var i=this;this.deviceId=t,e.createBLEConnection({deviceId:this.deviceId,success:function(e){console.log("蓝牙连接成功",e),i.getBLEDeviceServices()},fail:function(e){console.log("蓝牙连接失败",e)}})},stopBluetoothDevicesDiscovery:function(){var t=this;e.stopBluetoothDevicesDiscovery({success:function(e){t.loading=!1,console.log("停止搜索蓝牙设备:"+e.errMsg)},fail:function(e){console.log("停止搜索蓝牙设备失败，错误码："+e.errCode)}})},getBLEDeviceCharacteristics:function(){var t=this,i=this;console.log("进入特征"),setTimeout((function(){e.getBLEDeviceCharacteristics({deviceId:t.deviceId,serviceId:t.serviceId,success:function(e){console.log("特征getBLEDeviceCharacteristics",e),t.characteristics=e.characteristics,console.log("特征数组",t.characteristics),e.characteristics.forEach((function(e){-1!=e.uuid.indexOf("FFE1")&&(i.characteristicId=e.uuid,i.notifyBLECharacteristicValueChange(e.uuid))}))},fail:function(e){console.log(e)}})}),1e3)},notifyBLECharacteristicValueChange:function(t){var i=this;console.log(t,"characteristicId"),e.notifyBLECharacteristicValueChange({state:!0,deviceId:this.deviceId,serviceId:this.serviceId,characteristicId:t,success:function(e){console.log(e),i.listenValueChange(),console.log("notifyBLECharacteristicValueChange success",e.errMsg)},fail:function(e){console.log("notifyBLECharacteristicValueChange fail",e.errMsg)}})},getBLEDeviceServices:function(){var t=this;setTimeout((function(){e.getBLEDeviceServices({deviceId:t.deviceId,success:function(e){console.log("获取到蓝牙所有的服务:",e),e.services.forEach((function(e){-1!=e.uuid.indexOf("FFE0")&&(t.serviceId=e.uuid,console.log("1800特征值",t.serviceId),t.getBLEDeviceCharacteristics())}))}})}),1e3)},strToHexCharCode:function(e){if(""===e)return"";var t=[];t.push("0x");for(var i=0;i<e.length;i++)t.push(e.charCodeAt(i).toString(16));return t.join("")},handleInToPay:function(){var t={deviceId:this.deviceId,serviceId:this.serviceId,unids:this.list[0].name.slice(4),characteristicId:this.characteristicId},i=JSON.stringify(t);e.navigateTo({url:"/pages/game/detail?param="+i})},writeBLECharacteristicValue:function(t){for(var i=this.list[0].name.slice(4),c=t+i,n=new ArrayBuffer(c.length),o=new DataView(n),r=0;r<c.length;r++)o.setUint8(r,c.charAt(r).charCodeAt());var s=this.ab2hex(n)+"0D0A",a=new Uint8Array(s.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer;e.writeBLECharacteristicValue({deviceId:this.deviceId,serviceId:this.serviceId,characteristicId:this.characteristicId,value:a,success:function(t){console.log("写入成功",t),e.showToast({icon:"none",title:"开启成功"})},fail:function(e){console.log("写入失败1",JSON.stringify(e))}})},string2buffer:function(e){for(var t="",i=0;i<e.length;i++)""===t?t=e.charCodeAt(i).toString(16):t+=","+e.charCodeAt(i).toString(16);return console.log("16数据",t),new Uint8Array(t.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)}))).buffer},str2ab:function(e){for(var t=new ArrayBuffer(e.length/2),i=new Uint8Array(t),c=0;c<i.length;c++)i[c]=parseInt(e.substr(2*c,2),16);return t},ab2hex:function(e){var t=Array.prototype.map.call(new Uint8Array(e),(function(e){return e.toString(16).slice(-2)}));return t.join("")},hexCharCodeToStr:function(e){var t,i=e.trim(),c="0x"===i.substr(0,2).toLowerCase()?i.substr(2):i,n=c.length;if(n%2!==0)return alert("存在非法字符!"),"";for(var o=[],r=0;r<n;r+=2)t=parseInt(c.substr(r,2),16),o.push(String.fromCharCode(t));return o.join("")},listenValueChange:function(){var t=this;console.log("进去了吗"),t.showButton=!0,e.onBLECharacteristicValueChange((function(e){console.log("进去了吗1111",e);var i=t.ab2hex(e.value);console.log(i);var c=t.hexCharCodeToStr(i);console.log("最终结果",c)}))}}};t.default=c}).call(this,i("543d")["default"])},be4b:function(e,t,i){"use strict";i.r(t);var c=i("650e"),n=i("d3b6");for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);i("e3b3");var r=i("f0c5"),s=Object(r["a"])(n["default"],c["b"],c["c"],!1,null,"361dc3f1",null,!1,c["a"],void 0);t["default"]=s.exports},c91f:function(e,t,i){"use strict";(function(e,t){var c=i("4ea4");i("6c5a");c(i("66fd"));var n=c(i("be4b"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},d3b6:function(e,t,i){"use strict";i.r(t);var c=i("b9e4"),n=i.n(c);for(var o in c)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return c[e]}))}(o);t["default"]=n.a},e3b3:function(e,t,i){"use strict";var c=i("7fe9"),n=i.n(c);n.a}},[["c91f","common/runtime","common/vendor"]]]);